# Шаблон программы для PIC

## Назначение

Репозитарий предназначен для быстрого развертывания шаблона программы
для микроконтроллеров.

## Состав

- Makefile :: Основной сборочный файл
- build/ :: Результаты сборки
- doc/ :: Документация
- packages/ :: Архивы с файлами и документацией
- patches/ :: Патчи для быстрого конфигурирования
- releases/ :: Hex-файлы вариантов программ
- src/ :: Исходные коды и заголовочные файлы
  - main.c :: Главный файл
  - isr.c :: Прерывания
  - confbits.c :: Биты конфигурации
  - defs.h :: Макросы для всех файлов

### Именование hex-файлов

<имя проекта>-<контроллер>-<версия>.<сборка>

### Makefile

Параметры проекта:
- PRJ_NAME :: Имя проекта, используется в названии hex-файла
- CHIP :: Марка микроконтроллера, используется при сборке и в имени
  файла
- VER :: Версия программы, используется в имени файла
- OBJS :: Исходные коды (.c)

Цели:
- RELEASES
  - all :: Собрать все варианты программы
  - main :: Основная сборка программы
  - <имя> :: Другие варианты сборки, используется в имени файла

Другие варианты сборки могут отличаться:
- используемым контроллером
- директивами препроцессора
  - cath :: для индикаторов с общим катодом
  - ands :: для индикаторов с общим анодом

### Выпуск нового релиза

Реестр IdLoc http://konstantin-morenko.ru/my-pic-idloc/

Система именования версий https://semver.org

- [ ] Протестировать работу программы
- [ ] Пометить старый IdLoc как устаревший
- [ ] Назначить новый IdLoc
- [ ] Описать ChangeLog
- [ ] Проверить согласованность документации и изменений в коде
- [ ] Сделать коммит
- [ ] Назначить тег коммиту и вписать в сообщение ChangeLog
- [ ] Загрузить на github.com
- [ ] Добавить в Packages на GitHub скомпилированные .hex
- [ ] Обновить информацию о новом IdLoc в реестре

## Исходный код

### defs.h

#### _XTAL_FREQ Частота генератора

Все числа, которые зависят от частоты генератора ДОЛЖНЫ быть вычислены
через макрос ~_XTAL_FREQ~, равный частоте кварцевого резонатора.
Сначала она должна быть разделена на 4, чтобы определить число
операций микроконтроллера в секунду.

По умолчанию задана частота в 4 МГц.  Это значение задается в файле
~confbits.c~ при настройке генератора, но только если частота не
задана принудительно, в том числе через командную строку, например,
~-D_XTAL_FREQ=4000000~.

### main.c

Определена функция настройки прерываний по TMR0 ~inline void
set_tmr0_int(void)~, которая задает прерывания по таймеру от
внутреннего генератора без предделителя, с периодичностью 256 циклов.
